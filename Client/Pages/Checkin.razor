@page "/Checkin"
@using HotelFinal.Client.Services;
@using HotelFinal.Shared;
@inject HotelService hotelService
<h3>Checkin</h3>

<AuthorizeView Roles="Administrator, Staff">
    <Authorized>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Guest</th>
                    <th>Checkin date</th>
                    <th>Checkout date</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var res in Reservations)
                {
                    //var reser = reservationList.Find(res.Reservation);
                    <tr>
                        <td>@res.Guest.LastName</td>
                        <td>@res.ExpectedCheckin</td>
                        <td>@res.ExpectedCheckout</td>
                        <td>
                            <button class="btn btn-primary" 
                            @onclick="() => CheckinGuest(res)">
                                Checkin
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </Authorized>
</AuthorizeView>


@code {
    public List<Reservation> Reservations { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        Reservations = await hotelService.AllReservationsWithoutRentals();
    }

    private async Task<bool> HasRental(int resId)
    {
        var rental = await hotelService.GetReservationRental(resId);

        if (rental is null)
        {
            return false;
        }

        return true;
    }

    public async Task CheckinGuest(Reservation reservation)
    {
        try
        {
            await hotelService.CreateRentalAsync(reservation);
        }
        catch
        {
            int x = 7;
        }

        Reservations = await hotelService.AllReservationsWithoutRentals();
    }
}
